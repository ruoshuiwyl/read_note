# 大规模分布式存储系统
## 单机存储引擎
-  哈希存储 键值存储系统
-  B树存储  关系数据库 MySQL InnoDB
-  LSM树存储 levelDB
## 事务与并发控制
- 原子性
- 一致性
- 隔离性  
- 持久性

隔离级别：
- RU 读取未提交数据
- RC 读取已提交数据
- RR 重复读取
- S  事务串行化执行
  
异常：
- LU 第一类丢失更新, 两个事务同时修改一个数据项,后者事务失败回滚,前者事务已提交的修改丢失
- DR 一个事务读取另一个事务更新去没有提交的数据项
- NRR 一个事务对同一个数据项多次读取结果不一致
- SLU 第二类丢失更新,两个事务同时读取和修改同一数据项,后面修改造成前面修改丢失
- PR 幻读, 事务执行过程中,前面查询和后面查询期间,存在另一个事务插入数据,造成事物前后查询不一致

> 隔离级别与读写异常

|    | LU | DR | NRR | SLU | PR |
| -- | -- | -- |  -- | --  | -- |
| RU | N  | Y  | Y  | Y  | Y  |
| RC | N  | N  | Y  | Y  | Y  |
| RR | N  | N  | N  | N  | Y  |
| S  | N  | N  | N  | N  | N  |

并发控制
- 数据库锁 读写锁 死锁->超时设置,超时自动回滚；死锁检测,回滚部分事务
- 写时复制
- 多版本并发控制 (mysql innoDB)
    - select 行修改版本号小于等于该事务号,行删除版本号未定义或大于该事务的版本号
    - insert 对新插入的行,行的修改版本号就是该事务版本号
    - delete 该行的删除版本号设置为该事务版本号
    - update 复制该行,该行的事务号设置为该事务版本号

 故障恢复
 操作日志 回滚(UNDO)日志, 重做(REDO)日志, UNDO/REDO日志
 日志优化 成组提交(Group Commit), 检查点